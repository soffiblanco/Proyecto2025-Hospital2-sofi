version: "3.8"

services:
# --- Frontend ---
frontend:
build:
context: . # usa la raíz del repo
dockerfile: src/Dockerfile # tu Dockerfile está en ./src/Dockerfile
ports:
- "80:80"
depends_on:
- backend
networks:
- app-network

# --- Backend (Quarkus) ---
backend:
build:
context: ./backend
dockerfile: Dockerfile.jvm
ports:
- "8080:8080"
environment: # <-- usa mapa YAML, NO "="
QUARKUS_DATASOURCE_JDBC_URL: "jdbc:oracle:thin:@db:1521/XEPDB1"
QUARKUS_DATASOURCE_USERNAME: "C##PROYECTO"
QUARKUS_DATASOURCE_PASSWORD: "Unis"
depends_on:
- db
networks:
- app-network

# --- Base de datos (Oracle XE) ---
db:
image: container-registry.oracle.com/database/express:latest
environment:
ORACLE_PASSWORD: "Unis"
ports:
- "1521:1521"
networks:
- app-network

# --- Prometheus ---
prometheus:
image: prom/prometheus:latest
ports:
- "9090:9090"
volumes:
- ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro
networks:
- app-network

# --- Grafana ---
grafana:
image: grafana/grafana:latest
ports:
- "3000:3000"
depends_on:
- prometheus
networks:
- app-network

networks:
app-network:
driver: bridge
